## API-Football v3 ドキュメント詳細サマリー（2025年最新版）

### 概要

API-Footballは、サッカーに関する多様なデータを提供するためのRESTful APIです。データは**1,100以上**のサッカー大会をカバーしています。APIは[RapidAPI](https://rapidapi.com/)マーケットプレイスを通じて提供されます。

### 最新バージョン情報（2025年）

- **現在バージョン**: v3.9.2
- **新機能**: 
  - `odds/live` エンドポイント - 進行中の試合のオッズをリアルタイム取得
  - `odds/live/bets` エンドポイント - ライブベット情報
  - `fixtures` エンドポイントでの複数ID指定対応（`ids`パラメータ）
  - AI予測データの拡張
- **カバー範囲**: 1,100以上のリーグ・カップ戦
- **更新頻度**: ライブマッチ・イベントは15秒ごとに更新

### 1. 認証とヘッダー

APIへのすべてのリクエストには、認証のためにHTTPヘッダーに以下の2つの情報を含める必要があります。

*   `X-RapidAPI-Key`: RapidAPIで提供されるあなた個人のAPIキー。
*   `X-RapidAPI-Host`: `v3.football.api-sports.io` という固定のホスト名。

**ベースURL:** `https://v3.football.api-sports.io/`

### 2. レスポンス形式

APIからのレスポンスは、すべて標準化されたJSON形式で返されます。レスポンスの主な構成要素は以下の通りです。

*   `get`: 呼び出されたエンドポイント名 (例: `leagues`, `teams`)。
*   `parameters`: リクエスト時に使用されたパラメータのオブジェクト。
*   `errors`: エラーが発生した場合に、その内容が配列またはオブジェクトで格納されます。成功時は空の配列 `[]` となります。
*   `results`: `response` 配列に含まれる結果の件数（数値）。
*   `paging`: ページネーションに関する情報。
    *   `current`: 現在のページ番号。
    *   `total`: 全体の合計ページ数。
*   `response`: 実際のデータが格納される配列。APIから返される主要な情報はこの中にあります。

### 3. 主要な概念

#### 3.1. ページネーション (Pagination)

多くの結果を返すエンドポイントでは、データがページに分割されます。デフォルトでは1ページ目が返されます。2ページ目以降のデータを取得するには、リクエストパラメータに `page=2` のように追加します。`paging` オブジェクトの `total` を見ることで、総ページ数を確認できます。

#### 3.2. タイムゾーン (Timezone)

APIから返されるすべての日時情報（例: 試合のキックオフ時間）は、常に **UTC（協定世界時）** です。アプリケーションでユーザーに表示する際は、必要に応じてローカルタイムゾーンに変換する必要があります。

### 4. エンドポイント詳細

ドキュメントに記載されている主要なエンドポイントとその機能を以下にまとめます。

#### 4.1. 一般情報 (General)

*   **/status**: アカウント情報、APIサブスクリプションの状況、現在のAPIリクエスト使用量と上限を確認します。
*   **/countries**: APIで利用可能なすべての国・地域のリストを取得します。
*   **/timezone**: 利用可能なタイムゾーンのリストを取得します。

#### 4.2. リーグ (Leagues)

*   **/leagues**: リーグやカップ戦の情報を取得します。
    *   **主なパラメータ:** `id`, `name`, `country`, `season`, `type` (`league` or `cup`)
*   **/seasons**: APIで利用可能な全シーズン（年）のリストを取得します。

#### 4.3. チーム (Teams)

*   **/teams**: チームの情報を取得します。
    *   **主なパラメータ:** `id`, `name`, `league`, `season`, `country`
*   **/teams/statistics**: 特定のリーグ・シーズンにおけるチームの統計情報（総試合数、勝敗、得失点、フォーメーションなど）を取得します。
    *   **主なパラメータ:** `league` (必須), `season` (必須), `team` (必須), `date`
*   **/teams/seasons**: あるチームが参加した全シーズンを取得します。
    *   **主なパラメータ:** `team` (必須)

#### 4.4. 会場 (Venues)

*   **/venues**: スタジアムや会場の情報を取得します。
    *   **主なパラメータ:** `id`, `name`, `city`, `country`

#### 4.5. 順位表 (Standings)

*   **/standings**: リーグの順位表を取得します。
    *   **主なパラメータ:** `league` (必須), `season` (必須), `team`

#### 4.6. 試合 (Fixtures)

*   **/fixtures**: 試合の日程や結果を取得するための最も多機能なエンドポイントです。
    *   **主なパラメータ:** `id`, `ids` (複数ID指定, 2025年新機能), `live` (開催中の試合), `date`, `league`, `season`, `team`, `round`, `status` (試合状態)
*   **/fixtures/headtohead**: 2チーム間の直接対決（H2H）の履歴を取得します。
    *   **主なパラメータ:** `h2h` (例: `50-51`)
*   **/fixtures/statistics**: 1つの試合に関する詳細な統計情報（シュート数、ファール数、ボール支配率など）を取得します。
    *   **主なパラメータ:** `fixture` (必須)
*   **/fixtures/events**: 1つの試合で発生したイベント（ゴール、カード、交代など）の時系列データを取得します。
    *   **主なパラメータ:** `fixture` (必須)
*   **/fixtures/lineups**: 1つの試合のラインナップ（先発メンバー、フォーメーション）を取得します。
    *   **主なパラメータ:** `fixture` (必須)
*   **/fixtures/players**: 1つの試合に出場した全選手の統計情報を取得します。
    *   **主なパラメータ:** `fixture` (必須)

#### 4.7. オッズ (Odds) - 2025年新機能含む

*   **/odds**: 試合のブックメーカーオッズを取得します。
    *   **主なパラメータ:** `fixture`, `league`, `season`, `date`, `bookmaker`, `bet`
*   **/odds/live**: **[2025年新機能]** 進行中の試合のライブオッズを取得します。
    *   **主なパラメータ:** `fixture` (必須), `bookmaker`, `bet`
    *   **更新頻度:** リアルタイム更新（15秒間隔）
*   **/odds/live/bets**: **[2025年新機能]** ライブベット情報を取得します。
    *   **主なパラメータ:** `fixture` (必須), `bookmaker`

#### 4.8. 選手・監督など (Players / Coaches)

*   **/players/squads**: チームのスカッド（所属選手リスト）を取得します。
    *   **主なパラメータ:** `team` または `player`
*   **/players**: 選手の情報を検索します。
    *   **主なパラメータ:** `id`, `team`, `league`, `season`, `search`
*   **/trophies**: 選手または監督が獲得したトロフィー（優勝歴）を取得します。
    *   **主なパラメータ:** `player` または `coach`
*   **/sidelined**: 負傷や出場停止により離脱している選手の情報を取得します。
    *   **主なパラメータ:** `player`, `team`, `league`, `season`
*   **/transfers**: 選手の移籍情報を取得します。
    *   **主なパラメータ:** `player`, `team`
*   **/coachs**: 監督の情報を検索します。
    *   **主なパラメータ:** `id`, `team`, `search`

#### 4.9. 予測 (Predictions) - AI機能拡張

*   **/predictions**: 試合の勝敗予測などのAIによる予測データを取得します。
    *   **主なパラメータ:** `fixture` (必須)
    *   **提供情報:** 勝敗予測、アンダー/オーバー、得点予想、比較チーム統計
    *   **2025年拡張:** より精度の高いAI予測アルゴリズム採用

### 5. パラメータの詳細解説

APIを効果的に利用するためには、各エンドポイントで利用できるパラメータを理解することが重要です。

#### 5.1. IDの取得と利用

多くのエンドポイントは、`league` (リーグID)、`team` (チームID)、`fixture` (試合ID) などのIDをパラメータとして要求します。これらのIDを取得する基本的な流れは以下の通りです。

1.  **リーグIDの取得:**
    まず `/leagues` エンドポイントを使い、国名(`country`)やシーズン(`season`)で検索して、目的のリーグのIDを特定します。
    *例: `GET /leagues?country=England&season=2024`*
2.  **チームIDの取得:**
    次に、取得したリーグIDとシーズンを使い、`/teams` エンドポイントでそのリーグに所属するチームのリストと、各チームのIDを取得します。
    *例: `GET /teams?league=39&season=2024`*
3.  **試合や統計の取得:**
    最後に、取得したリーグIDやチームIDを使って、`/fixtures` や `/teams/statistics` などのより詳細な情報を取得します。
    *例: `GET /fixtures?team=40&season=2024`*

このように、複数のエンドポイントを連携させて目的のデータに到達することが基本となります。

#### 5.2. 試合ステータス (`status`) パラメータ

`/fixtures` エンドポイントで利用できる `status` パラメータは、試合の状態をフィルタリングするために非常に重要です。以下は、公式ドキュメントに記載されているステータスコードの一覧です。

*   **TBD (To Be Defined):** 開催日時未定
*   **NS (Not Started):** 未開始
*   **1H (First Half, Kick Off):** 前半
*   **HT (Halftime):** ハーフタイム
*   **2H (Second Half, 2nd Half Started):** 後半
*   **ET (Extra Time):** 延長戦
*   **P (Penalty In Progress):** PK戦実施中
*   **FT (Match Finished):** 試合終了
*   **AET (Match Finished After Extra Time):** 延長戦の末、試合終了
*   **PEN (Match Finished After Penalty):** PK戦の末、試合終了
*   **BT (Break Time):** 休憩時間（延長戦の前など）
*   **SUSP (Match Suspended):** 試合中断
*   **INT (Match Interrupted):** 試合割り込み
*   **PST (Match Postponed):** 延期
*   **CANC (Match Cancelled):** 中止
*   **ABD (Match Abandoned):** 放棄
*   **AWD (Technical Loss):** 不戦敗
*   **WO (WalkOver):** ウォークオーバー（不戦勝）

複数のステータスをハイフン `-` で連結して指定することも可能です。（例: `status=1H-HT-2H`）

### 6. エラーハンドリング

APIからのエラーは、レスポンスボディ内の `errors` フィールドと、HTTPステータスコードの2つの方法で示されます。

#### 6.1. レスポンス内の `errors` フィールド

リクエストが構文的に正しく、認証も通っているが、パラメータが不足している、または無効である場合に、このフィールドにエラー内容が記述されます。

**例1: 必須パラメータが不足している場合 (`/teams` で `league` を指定しなかった)**

```json
{
    "get": "teams",
    "parameters": {
        "season": "2024"
    },
    "errors": {
        "league": "Error/Missing application/json. league is a required property"
    },
    "results": 0,
    "response": []
}
```

**例2: APIキーが無効、またはサブスクリプションに問題がある場合**

```json
{
    "get": "status",
    "parameters": [],
    "errors": {
        "token": "Error/Missing application/json. check your token in request."
    },
    "results": 0,
    "response": []
}
```
この `errors` フィールドが空でない場合は、アプリケーション側でエラーとして処理する必要があります。

#### 6.2. HTTPステータスコード

リクエスト自体に問題がある場合や、サーバー側の問題を示すために標準的なHTTPステータスコードが返されます。

*   **200 OK:** リクエスト成功。
*   **403 Forbidden:** RapidAPIのプロキシサーバーにアクセスできていない、またはRapidAPI側で何らかの問題が発生している可能性があります。
*   **404 Not Found:** 間違ったエンドポイントURLにアクセスしています。
*   **429 Too Many Requests:** プランで許可されているレートリミット（1分あたり、または1日あたりのリクエスト上限）を超えました。
*   **500 Internal Server Error:** APIサーバー側で予期せぬ問題が発生しています。

### 7. API利用ガイドライン

*   **レートリミットの遵守:** アプリケーションのプランに応じたレートリミット（例: Freeプランなら100リクエスト/日）を超えないように、リクエスト数を管理することが不可欠です。`/status` エンドポイントで現在の使用状況を定期的に確認できます。
*   **IDのキャッシュ:** `leagues`, `teams`, `venues` などのIDは頻繁に変更されません。これらの情報を一度取得したら、アプリケーションのデータベースやキャッシュストレージに保存し、再利用することを強く推奨します。これにより、APIコール数を大幅に削減できます。
*   **効率的なクエリ:** `/fixtures` のような強力なエンドポイントでは、できるだけ多くのフィルタリングパラメータ（`league`, `season`, `date`など）を指定して、取得するデータ量を最小限に抑えるべきです。パラメータなしでリクエストすると、大量のデータが返され、すぐにレートリミットに達する可能性があります。
*   **ライブ試合のデータ取得:** ライブスコアを取得する際は、数秒ごとに `/fixtures` エンドポイントを叩くのではなく、ドキュメントで推奨されている間隔（通常は30秒から1分）でリクエストを送るべきです。

### 8. 実践的なユースケース例

#### 8.1. 特定リーグの開催中・未開始の試合を取得

イングランド・プレミアリーグ（ID: 39）の、現在開催中またはこれから開始される試合を取得します。

**リクエストURL:**
`GET https://v3.football.api-sports.io/fixtures?league=39&season=2024&status=NS-1H-HT-2H-ET-P`

#### 8.2. 特定の試合のラインナップとイベントを取得

特定の試合ID（例: 1189588）が分かっている場合に、その試合のラインナップとイベントを取得します。これには2回のAPIコールが必要です。

1.  **ラインナップ取得:**
    `GET https://v3.football.api-sports.io/fixtures/lineups?fixture=1189588`
2.  **イベント取得:**
    `GET https://v3.football.api-sports.io/fixtures/events?fixture=1189588`

これらの結果をクライアント側で組み合わせて表示することで、詳細な試合速報ページを構築できます。

### 9. 2025年新機能の詳細

#### 9.1. ライブオッズ機能

**エンドポイント:** `/odds/live`

ライブオッズ機能は、進行中の試合のブックメーカーオッズをリアルタイムで取得できる新機能です。

**特徴:**
- 15秒ごとにリアルタイム更新
- 複数ブックメーカーに対応
- 試合の状況に応じたオッズ変動を追跡

**使用例:**
```
GET /odds/live?fixture=1189588&bookmaker=8
```

#### 9.2. 複数試合の一括取得

**エンドポイント:** `/fixtures` with `ids` parameter

複数の試合IDを一度に指定して、イベント、ラインナップ、統計情報を一括取得できます。

**使用例:**
```
GET /fixtures?ids=1189588-1189589-1189590&include=events,lineups
```

#### 9.3. AI予測の精度向上

**エンドポイント:** `/predictions`

2025年版では、より多くのデータを学習したAIアルゴリズムを採用し、予測精度が向上しました。

**新しい予測項目:**
- 詳細なスコア予測
- 個人選手のパフォーマンス予測
- 戦術的分析データ

### 10. 無料プランの特徴（2025年更新）

- **全エンドポイントアクセス**: 制限なし
- **クレジットカード不要**: 永続的に無料
- **他スポーツAPI**: NBA、NFL、MMA、Formula-1なども利用可能
- **無料ウィジェット**: Webサイト埋め込み用ウィジェット提供
- **コミュニティサポート**: 開発者コミュニティでのサポート